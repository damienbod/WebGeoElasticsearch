@{
    ViewData["Title"] = "Home Page";
}

<input type="hidden" value="@Model.MapData" id="mapdata" name="mapdata" />

@using (Html.BeginForm("Search", "Home"))
{
    <fieldset class="form">
        <legend>SEARCH for closest document in the search engine using geo distance</legend>
        <table width="800">
            <tr>
                <th></th>
            </tr>
            <tr></tr>
            <tr>
                <td>
                    <input type="submit" value="Search for closest: " style="width: 300px">
                </td>
                <td>
                    <input type="hidden" value="@Model.CenterLongitude" id="centerLongitude" name="centerLongitude" />
                    <input type="hidden" value="@Model.CenterLatitude" id="centerLatitude" name="centerLatitude" />
                </td>
                <td>
                    <p style="width: 300px">Max distance in meter:</p>
                    <input id="maxDistanceInMeter" name="maxDistanceInMeter" type="text" title="" value="@Model.MaxDistanceInMeter" style="width: 200px" />
                </td>
            </tr>
        </table>
    </fieldset>

}

<div class="row">
    @*Bern	Lat 46.94792, Long 7.44461 *@
    <div id="map" style="width: 1000px; height: 800px;">
    </div>
</div>

<br />

@section scripts
{
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script language="javascript" type="text/javascript">

        var map = L.map('map').setView([46.94792, 7.44461], 13);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        //var marker = L.marker([46.94792, 7.44461]).addTo(map);

        ///////////////

        var modelData = $.parseJSON($("#mapdata").val());
        var first = true;
        $.each(modelData, function(entryIndex, entry) {

            var htmlString = "<a href=\"" + entry.Details + "\">" + entry.Name + "</a>";

            //alert("Lat: " + entry.DetailsCoordinates.lat + "Lon: " + entry.DetailsCoordinates.lon);
            if (first) {
                var marker = L.marker([entry.DetailsCoordinates.lon, entry.DetailsCoordinates.lat]).addTo(map);

                // var marker = new google.maps.Marker({
                //     position: new google.maps.LatLng(array[1], array[0]),
                //     html: htmlString,
                //     icon: "https://localhost:7275/yourposition.png"
                // });

                first = false;
            } else {
                var marker = L.marker([entry.DetailsCoordinates.lon, entry.DetailsCoordinates.lat]).addTo(map);
            }
        });



        // var map;
        // var mgr;

        // function initialize() {
        //     var myOptions = {
        //         zoom: 13,
        //         center: new google.maps.LatLng(46.94792, 7.44461),
        //         mapTypeId: google.maps.MapTypeId.ROADMAP
        //     };
        //     map = new google.maps.Map(document.getElementById("googleMap"), myOptions);
       
        //     var infoWindow = new google.maps.InfoWindow({ content: "contents" });
        //     google.maps.event.addListener(mgr, 'loaded', function() {

        //         var modelData = $.parseJSON($("#mapdata").val());
        //         var first = true;
        //         $.each(modelData, function(entryIndex, entry) {
        //             alert("Data" + entry.DetailsCoordinates + ", " + entry.Details);

        //             var htmlString = "<a href=\"" + entry.Details + "\">" + entry.Name + "</a>";
        //             var coor = entry.DetailsCoordinates.toString();
        //             var array = coor.split(',');

        //             // alert("Lat" + array[1] + "Long" + array[0]);
        //             if (first) {
        //                 const marker = new google.maps.marker.AdvancedMarkerElement({
        //                     map,
        //                     position: {lat: array[1], lng: array[0]},
        //                     html: htmlString,
        //                     icon: "https://localhost:7275/yourposition.png"
        //                   });

        //                 // var marker = new google.maps.Marker({
        //                 //     position: new google.maps.LatLng(array[1], array[0]),
        //                 //     html: htmlString,
        //                 //     icon: "https://localhost:7275/yourposition.png"
        //                 // });

        //                 first = false;
        //             } else {
        //                 var marker = new google.maps.Marker({
        //                     position: new google.maps.LatLng(array[1], array[0]),
        //                     html: htmlString
        //                 });
        //             }

        //             google.maps.event.addListener(marker, "click", function() {
        //                 infoWindow.setContent(this.html);
        //                 infoWindow.open(map, this);
        //             });

        //             mgr.addMarker(marker, 0);

        //         });

        //         // alert('homemarker: ' + $("#centerLatitude").val() + ' Current Lng: ' + $("#centerLongitude").val());

        //         var homemarker = new google.maps.Marker({

        //             position: new google.maps.LatLng($("#centerLatitude").val(), $("#centerLongitude").val()),
        //             html: "YOU",
        //             draggable: true,
        //             icon: "https://localhost:7275/ort.png"
        //         });

        //         google.maps.event.addListener(homemarker, 'dragend', function(evt) {
        //             // alert('Marker dropped: Current Lat: ' + evt.latLng.lat().toFixed(3) + ' Current Lng: ' + evt.latLng.lng().toFixed(3));
        //             $("#centerLongitude").val(evt.latLng.lng().toFixed(3));
        //             $("#centerLatitude").val(evt.latLng.lat().toFixed(3));
        //         });

        //         mgr.addMarker(homemarker, 0);

        //         mgr.refresh();
        //     });
        // }

        // google.maps.event.addDomListener(window, 'load', initialize);
    </script>
}